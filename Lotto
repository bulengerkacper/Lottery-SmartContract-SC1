pragma solidity ^0.4.19;

/* author @BulKac
OpenSource drawing lots in purpose of learning smart contracts */

/* To draw lots*/
contract TDL {

	uint64 public ticketPrize = 1;
	uint private jackpot;
	uint public tickets_sold;

	addres[] public players;

	event TicketsBought(address accountAddress, uint amount);
	event LotteryWinnerSet(address accountAddress, uint jackpotAmount);
	event playerCharged(addres accountAddres, uint chargedMoney);

	function TDL() {
		player = msg.sender;
	}

	function buyTicket() public returns (uint) {
		require (msg.value > ticketPrize);
	
			uint howManyTickets = msg.value/ticketPrize;

		for(uint counter = 0; counter < howManyTickets; counter++) {
			players.push(msg.sender);
		}
		uint realPrize = howManyTickets * ticketPrize;
		jackpot += realPrize;
		playerCharged(msg.sender, realPrize);
		msg.sender.transfer(msg.value-realPrize);
		tickets_sold += howManyTickets;
		delete players; // ?? pytanie co w kolejnej turze
		return howManyTickets;
		
	}

	function jackpot() constant returns (uint) {
		return balances[msg.sender];
	}

	function sendMoneyToWinnerEndLottery () payable {
	 	uint index = random() % players.length;
	 	event LotteryWinnerSet(players[index], uint jackpotAmount);
		players[index].send(jackpot);
	}
}
